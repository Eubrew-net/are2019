
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>cal_report_174b</title><meta name="generator" content="MATLAB 9.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-05-20"><meta name="DC.source" content="cal_report_174b.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Brewer Evaluation</a></li><li><a href="#3">configuration files</a></li><li><a href="#4">Sun_scan: Before Campaign</a></li><li><a href="#5">Sun_scan: Campaign</a></li><li><a href="#7">Definicion de variables: SC</a></li><li><a href="#8">dsp calibration</a></li><li><a href="#12">Tabla - resumen con resultados DSP y Umkehr</a></li><li><a href="#13">Tablas y ficheros de definiciones latex</a></li><li><a href="#14">Eto para escribir resultados a hoja excel.</a></li></ul></div><pre class="codeinput"><span class="comment">% options_pub.outputDir=fullfile(pwd,'latex','174','html'); options_pub.showCode=true;</span>
<span class="comment">% publish(fullfile(pwd,'cal_report_174b.m'),options_pub);</span>
</pre><h2 id="2">Brewer Evaluation</h2><pre class="codeinput">clear <span class="string">all</span>;
file_setup=<span class="string">'arenos2019_setup'</span>;

eval(file_setup);     <span class="comment">% configuracion por defecto</span>
Cal.n_inst=find(Cal.brw==174);
Cal.file_latex=fullfile(<span class="string">'.'</span>,<span class="string">'latex'</span>,Cal.brw_str{Cal.n_inst});
Cal.dir_figs=fullfile(<span class="string">'latex'</span>,filesep(),Cal.brw_str{Cal.n_inst},<span class="keyword">...</span>
                              filesep(),[Cal.brw_str{Cal.n_inst},<span class="string">'_figures'</span>],filesep());
mkdir(Cal.dir_figs);

<span class="keyword">try</span>
      save(Cal.file_save,<span class="string">'-Append'</span>,<span class="string">'Cal'</span>); <span class="comment">%sobreescribimos la configuracion guardada.</span>
<span class="keyword">catch</span> exception
      fprintf(<span class="string">'Error: %s\n Initializing data for Brewer %s\n'</span>,exception.message,Cal.brw_name{Cal.n_inst});
      save(Cal.file_save);
<span class="keyword">end</span>
</pre><pre class="codeoutput">
ans =

  logical

   1


ans =

  1&times;1 cell array

    {'IZO#185'}


ans =

  21&times;9 cell array

  Columns 1 through 5

    {'TSK#005'}    {[  5]}    {[2]}    {[0]}    {'005'}
    {'IOS#017'}    {[ 17]}    {[2]}    {[0]}    {'017'}
    {'SCO#033'}    {[ 33]}    {[2]}    {[0]}    {'033'}
    {'MAD#070'}    {[ 70]}    {[4]}    {[0]}    {'070'}
    {'UM#075' }    {[ 75]}    {[4]}    {[0]}    {'075'}
    {'MUR#117'}    {[117]}    {[4]}    {[0]}    {'117'}
    {'UM#126' }    {[126]}    {[4]}    {[0]}    {'126'}
    {'ARE#150'}    {[150]}    {[3]}    {[0]}    {'150'}
    {'COR#151'}    {[151]}    {[4]}    {[0]}    {'151'}
    {'K&amp;Z#158'}    {[158]}    {[3]}    {[0]}    {'158'}
    {'WRC#163'}    {[163]}    {[3]}    {[0]}    {'163'}
    {'ZAR#166'}    {[166]}    {[4]}    {[0]}    {'166'}
    {'UM#172' }    {[172]}    {[3]}    {[0]}    {'172'}
    {'JAP#174'}    {[174]}    {[3]}    {[0]}    {'174'}
    {'IZO#185'}    {[185]}    {[3]}    {[0]}    {'185'}
    {'MAD#186'}    {[186]}    {[3]}    {[0]}    {'186'}
    {'CAN#190'}    {[190]}    {[3]}    {[0]}    {'190'}
    {'TAM#201'}    {[201]}    {[3]}    {[0]}    {'201'}
    {'DNK#202'}    {[202]}    {[3]}    {[0]}    {'202'}
    {'DNK#228'}    {[228]}    {[3]}    {[0]}    {'228'}
    {'K&amp;Z#230'}    {[230]}    {[3]}    {[0]}    {'230'}

  Columns 6 through 9

    {'..\005\ICF15117&#8230;'}    {'..\005\ICF15117&#8230;'}    {'1857'}    {'1838'}
    {'..\017\ICF15315&#8230;'}    {'..\017\ICF15315&#8230;'}    {'2170'}    {'2097'}
    {'..\033\ICF15617&#8230;'}    {'..\033\ICF15617&#8230;'}    {'2329'}    {'2325'}
    {'..\070\ICF15617&#8230;'}    {'..\070\ICF15617&#8230;'}    {'1700'}    {'1700'}
    {'..\075\ICF15017&#8230;'}    {'..\075\ICF15017&#8230;'}    {'1769'}    {'1714'}
    {'..\117\icf14915&#8230;'}    {'..\117\ICF14915&#8230;'}    {'1536'}    {'1612'}
    {'..\126\icf15517&#8230;'}    {'..\126\ICF15517&#8230;'}    {'1710'}    {'1710'}
    {'..\150\Icf14915&#8230;'}    {'..\150\ICF15617&#8230;'}    {'0322'}    {'0325'}
    {'..\151\icf15315&#8230;'}    {'..\151\icf15315&#8230;'}    {'1198'}    {'1835'}
    {'..\158\ICF21218&#8230;'}    {'..\158\ICF21218&#8230;'}    {'0558'}    {'0521'}
    {'..\163\ICF17016&#8230;'}    {'..\163\ICF15017&#8230;'}    {'0270'}    {'0270'}
    {'..\166\icf15215&#8230;'}    {'..\166\ICF15215&#8230;'}    {'1952'}    {'1975'}
    {'..\172\ICF15117&#8230;'}    {'..\172\ICF15117&#8230;'}    {'0444'}    {'0444'}
    {'..\174\ICF20718&#8230;'}    {'..\174\ICF20718&#8230;'}    {'0444'}    {'0444'}
    {'..\185\config18&#8230;'}    {'..\185\config18&#8230;'}    {'0335'}    {'0335'}
    {'..\186\ICF14915&#8230;'}    {'..\186\ICF14915&#8230;'}    {'0317'}    {'0317'}
    {'..\190\ICF11419&#8230;'}    {'..\190\ICF11419&#8230;'}    {'0410'}    {'0410'}
    {'..\201\ICF15215&#8230;'}    {'..\201\ICF15017&#8230;'}    {'0283'}    {'0270'}
    {'..\202\ICF15215&#8230;'}    {'..\202\ICF15017&#8230;'}    {'0283'}    {'0270'}
    {'..\228\ICF15017&#8230;'}    {'..\228\ICF15017&#8230;'}    {'0242'}    {'0242'}
    {'..\230\ICF15215&#8230;'}    {'..\230\ICF15017&#8230;'}    {'0283'}    {'0270'}

XLSREAD unable to read sheet 'Incidencias.075'.
Requested sheet: 'Incidencias.075' not found.
 BrewerUM#075
-&gt;ERROR
     1

~/CODE/campaigns/are2019/bfiles/017/../017/ICF15315.017
-&gt;ERROR
     2

~/CODE/campaigns/are2019/bfiles/017/../017/ICF15315.017
-&gt;ERROR
     1

~/CODE/campaigns/are2019/bfiles/150/../150/ICF14915.150
-&gt;ERROR
     2

~/CODE/campaigns/are2019/bfiles/150/../150/ICF15617.150
-&gt;ERROR
     1

~/CODE/campaigns/are2019/bfiles/185/../185/CONFIG185.CFG
-&gt;ERROR
     2

~/CODE/campaigns/are2019/bfiles/185/../185/CONFIG185_A.CFG
-&gt;ERROR
     1

~/CODE/campaigns/are2019/bfiles/201/../201/ICF15215.201
-&gt;ERROR
     2

~/CODE/campaigns/are2019/bfiles/201/../201/ICF15017.201
-&gt;ERROR
     1

~/CODE/campaigns/are2019/bfiles/202/../202/ICF15215.202
-&gt;ERROR
     1

~/CODE/campaigns/are2019/bfiles/230/../230/ICF15215.230
-&gt;ERROR
     2

~/CODE/campaigns/are2019/bfiles/230/../230/ICF15017.202
Warning: Directory already exists. 
</pre><h2 id="3">configuration files</h2><pre class="codeinput">close <span class="string">all</span>
[config_def,TCdef,DTdef,ETCdef,A1def,ATdef]=read_icf(Cal.brw_config_files{Cal.n_inst,2});
[config_orig,TCorig,DTorig,ETCorig,A1orig,ATorig]=read_icf(Cal.brw_config_files{Cal.n_inst,1});

Station.OSC=680;
Station.name=<span class="string">''</span>;
Station.lat=67;
Station.long=50;
Station.meanozo=350;

cal_step={}; sc_avg={}; sc_raw={}; Args={};
</pre><h2 id="4">Sun_scan: Before Campaign</h2><pre class="codeinput">close <span class="string">all</span>
[cal_step{1},sc_avg{1},sc_raw{1},Args{1}]=sc_report(Cal.brw_str{Cal.n_inst},Cal.brw_config_files{Cal.n_inst,1},<span class="keyword">...</span>
                     <span class="string">'date_range'</span>,datenum(Cal.Date.cal_year,1,[1 159]),<span class="keyword">...</span>
                     <span class="string">'CSN_orig'</span>,config_orig(14),<span class="string">'OSC'</span>,Station.OSC,<span class="keyword">...</span>
                     <span class="string">'control_flag'</span>,1,<span class="string">'residual_limit'</span>,35,<span class="keyword">...</span>
                     <span class="string">'hg_time'</span>,15,<span class="string">'one_flag'</span>,1);
</pre><pre class="codeoutput">174
warning Date error in file

ans =

    -1    12    30     0     0     0

OK-&gt;B10919.174
warning Date error in file

ans =

    -1    12    30     0     0     0

OK-&gt;B11019.174
warning Date error in file

ans =

    -1    12    30     0     0     0

OK-&gt;B11119.174
warning Date error in file

ans =

    -1    12    30     0     0     0

Error in measure
./bdata174/B13019.174
OK-&gt;B13019.174
warning Date error in file

ans =

    -1    12    30     0     0     0

OK-&gt;B13119.174
warning Date error in file

ans =

    -1    12    30     0     0     0

OK-&gt;B13219.174
warning Date error in file

ans =

    -1    12    30     0     0     0

OK-&gt;B13319.174
</pre><img vspace="5" hspace="5" src="cal_report_174b_01.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_02.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_03.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_04.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_05.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_06.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_07.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_08.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_09.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_10.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_11.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_12.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_13.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_14.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_15.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_16.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_17.png" alt=""> <img vspace="5" hspace="5" src="cal_report_174b_18.png" alt=""> <h2 id="5">Sun_scan: Campaign</h2><pre class="codeinput">[cal_step{2},sc_avg{2},sc_raw{2},Args{2}]=sc_report(Cal.brw_str{Cal.n_inst},Cal.brw_config_files{Cal.n_inst,2},<span class="keyword">...</span>
                     <span class="string">'date_range'</span>,datenum(Cal.Date.cal_year,1,Cal.calibration_days{Cal.n_inst,1}([1 end])),<span class="keyword">...</span>
                     <span class="string">'CSN_orig'</span>,config_def(14),<span class="string">'OSC'</span>,Station.OSC,<span class="keyword">...</span>
                     <span class="string">'control_flag'</span>,1,<span class="string">'residual_limit'</span>,15,<span class="keyword">...</span>
                     <span class="string">'hg_time'</span>,5,<span class="string">'one_flag'</span>,1);
</pre><pre class="codeoutput">174
</pre><pre class="codeinput">ix=sort(findobj(<span class="string">'tag'</span>,<span class="string">'SC_INDIVIDUAL'</span>)); figure(ix); set(get(gca,<span class="string">'title'</span>),<span class="string">'FontSize'</span>,8);
printfiles_report(ix',Cal.dir_figs,<span class="string">'aux_pattern'</span>,ix,<span class="string">'FontSize'</span>,.9,<span class="string">'Width'</span>,8.5,<span class="string">'Height'</span>,7);

ix=sort(findobj(<span class="string">'tag'</span>,<span class="string">'Final_SC_Calculation'</span>));
<span class="keyword">if</span> length(ix)&gt;1
    Width=8; Height=6;
    <span class="keyword">for</span> i=1:length(ix), figure(ix(i)); set(get(gca,<span class="string">'title'</span>),<span class="string">'FontSize'</span>,8); <span class="keyword">end</span>
<span class="keyword">else</span>
    Width=13; Height=8;
<span class="keyword">end</span>
printfiles_report(ix',Cal.dir_figs,<span class="string">'aux_pattern'</span>,ix,<span class="string">'Width'</span>,Width,<span class="string">'Height'</span>,Height);

close <span class="string">all</span>
</pre><pre class="codeoutput">
naux =

     1


naux =

     1

</pre><h2 id="7">Definicion de variables: SC</h2><pre class="codeinput"><span class="keyword">if</span> length(cal_step)&gt;1
   d_p=[length(cal_step)-1 length(cal_step)];   tags={<span class="string">''</span>,<span class="string">'new'</span>};
<span class="keyword">else</span>
   d_p=1;   tags={<span class="string">'new'</span>};
<span class="keyword">end</span>

idx=1; cal_step_error={};
<span class="keyword">for</span> t=d_p <span class="comment">% Siempre el pen&#65533;ltimo y &#65533;ltimo procesados (si hay m&#65533;s de uno)</span>
     cal_step_error{t}=round(mean([abs(cal_step{t}(2)-cal_step{t}(3)),abs(cal_step{t}(2)-cal_step{t}(4))]));
     latexcmd(fullfile(Cal.file_latex,[<span class="string">'cal_wavelengthSC'</span>,tags{idx},<span class="string">'_'</span>,Cal.brw_str{Cal.n_inst}]),<span class="keyword">...</span>
                                      [<span class="string">'\numSC'</span>,tags{idx}],size(sc_avg{t},1),<span class="keyword">...</span>
                                      [<span class="string">'\CALCSTEP'</span>,tags{idx}],round(cal_step{t}(1)),<span class="keyword">...</span>
                                      [<span class="string">'\calsteperror'</span>,tags{idx}],cal_step_error{t});
     idx=idx+1;
<span class="keyword">end</span>
sunscan{Cal.n_inst}.cal_step=cal_step;
sunscan{Cal.n_inst}.cal_step_error=cal_step_error;
sunscan{Cal.n_inst}.sc_avg=sc_avg; sunscan{Cal.n_inst}.sc_raw=sc_raw;
sunscan{Cal.n_inst}.info=Args;
save(Cal.file_save,<span class="string">'-APPEND'</span>,<span class="string">'sunscan'</span>);
</pre><h2 id="8">dsp calibration</h2><pre class="codeinput">res={}; detail={}; DSP_QUAD={}; QUAD_SUM={}; QUAD_DETAIL={};
CUBIC_SUM={}; CUBIC_DETAIL={}; salida={}; CSN_icf={};

l=dir(fullfile(<span class="string">'DSP'</span>,[Cal.brw_str{Cal.n_inst},<span class="string">'*'</span>]));
ldsp=cellstr(cat(1,l.name));
ldsp=ldsp(end-3:end)
<span class="keyword">for</span> jj=1:length(ldsp)  <span class="comment">%% ojo solo funciona si config es igual para todos</span>
</pre><pre>  if jj==length(ldsp),confign=2; else confign=1; end</pre><pre class="codeinput">    <span class="keyword">try</span>
      [res{jj},detail{jj},DSP_QUAD{jj},QUAD_SUM{jj},QUAD_DETAIL{jj},<span class="keyword">...</span>
       CUBIC_SUM{jj},CUBIC_DETAIL{jj},salida{jj},CSN_icf{jj},<span class="keyword">...</span>
       ]=dspreport(Cal,<span class="string">'dsp_dir'</span>,fullfile(<span class="string">'DSP'</span>,ldsp{jj}),<span class="string">'config_n'</span>,1);<span class="comment">%</span>
    <span class="keyword">catch</span>
       warning(sprintf(<span class="string">'Error en %s. DSP: %s'</span>,Cal.brw_name{Cal.n_inst},ldsp{jj}));
       res{jj}=NaN*ones(15,9,2); detail{jj}=NaN*ones(7,6,15,2); QUAD_DETAIL{jj}=NaN;
       <span class="comment">%res{jj}=NaN*ones(9,7,2); detail{jj}=NaN*ones(6,6,9,2); QUAD_DETAIL{jj}=NaN;</span>
    <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
<span class="comment">% Para salvar los datos de cada brewer</span>
dates=sscanf(cell2str(cat(2,ldsp')),<span class="string">'%03d_%03d_%03d,'</span>,[3,Inf]);
dates=datejul(dates(2:3,:)');dates=dates(:,1);
dsp_summary{Cal.n_inst}.info=cellstr(datestr(dates))';
dsp_summary{Cal.n_inst}.res=res;
dsp_summary{Cal.n_inst}.detail=detail;
dsp_summary{Cal.n_inst}.salida=salida;

save(Cal.file_save,<span class="string">'-APPEND'</span>,<span class="string">'dsp_summary'</span>);
</pre><pre class="codeoutput error">Error using cellstr (line 49)
Conversion to cellstr from double is not possible.

Error in cal_report_174b (line 92)
ldsp=cellstr(cat(1,l.name));
</pre><pre class="codeinput">ix=sort(findobj(<span class="string">'tag'</span>,<span class="string">'DSP_QUAD_RES'</span>));
printfiles_report(ix',Cal.dir_figs,<span class="string">'aux_pattern'</span>,ix);

close <span class="string">all</span>
</pre><h2 id="12">Tabla - resumen con resultados DSP y Umkehr</h2><pre class="codeinput"> QUAD_SUM_table={}; rows={}; tabla_QuadSum={}; format <span class="string">short</span> <span class="string">g</span>;
 <span class="keyword">if</span> config_orig(14)~=config_def(14)
    idx=1:length(res)+1; idx(end-1)=0; idx(end)=length(res);
    <span class="keyword">for</span> t=[1:length(res)-1,length(res)+1]
        tabla_QuadSum{t}=num2cell(round(res{idx(t)}(end-1,:,1)*10^4)/10^4);
    <span class="keyword">end</span>
    tabla_QuadSum{length(res)}=num2cell(round(res{length(res)}(res{length(res)}(:,1,1)==config_orig(14),:,1)*10^4)/10^4);
    Q_SUM_table_RowLabels={<span class="string">'Current'</span>,dsp_summary{Cal.n_inst}.info{:},dsp_summary{Cal.n_inst}.info{end},<span class="string">'Final'</span>};
 <span class="keyword">else</span>
    <span class="keyword">for</span> t=1:length(res)
        tabla_QuadSum{t}=num2cell(round(res{t}(end-1,:,1)*10^4)/10^4);
    <span class="keyword">end</span>
    Q_SUM_table_RowLabels={<span class="string">'Current'</span>,dsp_summary{Cal.n_inst}.info{:},<span class="string">'Final'</span>};
 <span class="keyword">end</span>

 tabla_QuadSum_str=cat(1,tabla_QuadSum{:});

 data_ini=cellfun(@(x) (round(x(:,1)*10^4))/10^4,{config_orig(8),config_orig(9),config_orig(10)},<span class="string">'UniformOutput'</span>,false);
 data_fin=cellfun(@(x) (round(x(:,1)*10^4))/10^4,{config_def(8),config_def(9),config_def(10)},<span class="string">'UniformOutput'</span>,false);
 QUAD_SUM_table=[{config_orig(14),data_ini{:}}   <span class="comment">% Current</span>
                 tabla_QuadSum_str(:,[1 2 4 5])  <span class="comment">% Calculated</span>
                 {config_def(14),data_fin{:}}];  <span class="comment">% Final</span>
 disp([Q_SUM_table_RowLabels',QUAD_SUM_table]);

label_1={<span class="string">'slit\#0'</span>,<span class="string">'slit\#1'</span>,<span class="string">'slit\#2'</span>,<span class="string">'slit\#3'</span>,<span class="string">'slit\#4'</span>,<span class="string">'slit\#5'</span>};
UMK_TABLE={};
 <span class="keyword">for</span> um=1:length(res)
    steps_umk=res{um}(end-1:end,1,1);

    UMK_TABLE{um}=[];
    <span class="keyword">for</span> iumk=1:2
      label_2={sprintf(<span class="string">'step= %d '</span>,fix(steps_umk(iumk)));<span class="string">'WL(A)'</span>;<span class="string">'Res(A)'</span>;<span class="string">'O3abs(1/cm)'</span>;<span class="string">'Ray abs(1/cm)'</span>};
      <span class="keyword">if</span> iumk==2, dumk=0; <span class="keyword">else</span> dumk=iumk; <span class="keyword">end</span>

      data=[label_2,[label_1;num2cell([round(detail{um}(1,:,end-dumk,1));detail{um}(2:4,:,end-dumk,1)])]];
      UMK_TABLE{um}=[UMK_TABLE{um};data];
    <span class="keyword">end</span>
 <span class="keyword">end</span>
</pre><h2 id="13">Tablas y ficheros de definiciones latex</h2><pre class="codeinput"> indx=1;
<span class="keyword">for</span> t=1:length(res)
    <span class="keyword">if</span> t==1 indx=[]; <span class="keyword">else</span> indx=t-1; <span class="keyword">end</span>
<span class="comment">% Se mantienen todas las tablas detalladas (tantas como test's analizados: 0, 1, 2, ...), por si se requieren en el futuro</span>
    matrix2latex_QDETAIL(QUAD_DETAIL{t},<span class="keyword">...</span>
                      fullfile(Cal.file_latex,[<span class="string">'table_QDETAIL'</span>,num2str(indx),<span class="string">'_'</span>,Cal.brw_str{Cal.n_inst},<span class="string">'.tex'</span>]),<span class="keyword">...</span>
                      <span class="string">'alignment'</span>,<span class="string">'c'</span>,<span class="string">'resize'</span>,0.9,<span class="string">'size'</span>,<span class="string">'footnotesize'</span>);
<span class="comment">% Idem para umkehr</span>
     matrix2latex_ctable(UMK_TABLE{t},<span class="keyword">...</span>
                      fullfile(Cal.file_latex,[<span class="string">'table_UMK'</span>,num2str(indx),<span class="string">'_'</span>,Cal.brw_str{Cal.n_inst},<span class="string">'.tex'</span>]),<span class="keyword">...</span>
                      <span class="string">'alignment'</span>,<span class="string">'c'</span>,<span class="string">'resize'</span>,0.9,<span class="string">'size'</span>,<span class="string">'footnotesize'</span>);
<span class="keyword">end</span>
<span class="comment">% Una unica tabla - resumen</span>
matrix2latex_ctable(QUAD_SUM_table,fullfile(Cal.file_latex,[<span class="string">'table_dsp'</span>,<span class="string">'_'</span>,Cal.brw_str{Cal.n_inst},<span class="string">'.tex'</span>]),<span class="keyword">...</span>
            <span class="string">'Columnlabels'</span>,{<span class="string">'Calc-step'</span>, <span class="string">'O3abs coeff.'</span>, <span class="string">'SO2abs coeff.'</span>, <span class="string">'O3/SO2'</span>},<span class="keyword">...</span>
            <span class="string">'RowLabels'</span>, Q_SUM_table_RowLabels,<span class="string">'alignment'</span>, <span class="string">'c'</span>,<span class="keyword">...</span>
            <span class="string">'resize'</span>,0.8,<span class="string">'format'</span>,{<span class="string">'%d'</span>,<span class="string">'%6.4f'</span>,<span class="string">'%6.4f'</span>,<span class="string">'%6.4f'</span>},<span class="string">'size'</span>,<span class="string">'footnotesize'</span>);

<span class="comment">% Definicion de variables</span>
<span class="keyword">if</span> length(res)&gt;1
   d_p=[length(res)-1 length(res)];   tags={<span class="string">''</span>,<span class="string">'new'</span>};
<span class="keyword">else</span>
   d_p=1;   tags={<span class="string">'new'</span>};
<span class="keyword">end</span>

idx=1;
<span class="keyword">for</span> t=d_p <span class="comment">% Siempre el pen&#65533;ltimo y &#65533;ltimo procesados (si hay m&#65533;s de uno)</span>
               <span class="comment">% Solo vale para dos test's !!</span>
     latexcmd(fullfile(Cal.file_latex,[<span class="string">'cal_wavelengthDSP'</span>,tags{idx},<span class="string">'_'</span>,Cal.brw_str{Cal.n_inst}]),<span class="keyword">...</span>
                                      [<span class="string">'\Auno'</span>,tags{idx}],round(res{t}(end-1,2,1)*10000)/10000,<span class="keyword">...</span><span class="comment">% O3</span>
                                      [<span class="string">'\Ados'</span>,tags{idx}],round(res{t}(end-1,4,1)*10000)/10000,<span class="keyword">...</span><span class="comment">% ratio? MAL</span>
                                      [<span class="string">'\Atres'</span>,tags{idx}],round(res{t}(end-1,5,1)*10000)/10000,<span class="keyword">...</span><span class="comment">% SO2</span>
                                      [<span class="string">'\UMKoffset'</span>,tags{idx}],fix(res{t}(end,1)));
     idx=idx+1;
 <span class="keyword">end</span>
</pre><h2 id="14">Eto para escribir resultados a hoja excel.</h2><pre>for dsps=1:length(ldsp)
    legend1={'step',sprintf('ICF (%d, %d)',CSN_icf{dsps}(1),CSN_icf{dsps}(3)),'abs step','A1 Q','A1 S'};
     dsp_table=NaN*ones(9,size(legend1,2));
     dsp_table(:,1:5)=[res{dsps}(:,1,1),NaN*ones(9,1),res{dsps}(:,1,1)+salida{dsps}{1}.cal_ozonepos,...
                       res{dsps}(:,2,1)*10000,res{dsps}(:,2,2)*10000];
     dsp_table(end-1,2)=CSN_icf{dsps}(2)*10000;</pre><pre>     aux=round(dsp_table); aux(:,[2 4 5])=aux(:,[2 4 5])/10000;
     aux=[legend1;num2cell(aux)];
     cell2str(aux,'\t')
     xlswrite('./DSP/dsp_todo.xls',ldsp(dsps),Cal.brw_name{Cal.n_inst},['A',num2str(1+(dsps-1)*11)]);
     xlswrite('./DSP/dsp_todo.xls',aux,Cal.brw_name{Cal.n_inst},['B',num2str(1+(dsps-1)*11)]);
end
     xlswrite('./DSP/dsp_IZO2.xls',[Q_SUM_table_RowLabels',QUAD_SUM_table],[Cal.brw_name{Cal.n_inst},'_sum']);</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018a</a><br></p></div><!--
##### SOURCE BEGIN #####
% options_pub.outputDir=fullfile(pwd,'latex','174','html'); options_pub.showCode=true;
% publish(fullfile(pwd,'cal_report_174b.m'),options_pub);

%% Brewer Evaluation
clear all;
file_setup='arenos2019_setup';

eval(file_setup);     % configuracion por defecto
Cal.n_inst=find(Cal.brw==174);
Cal.file_latex=fullfile('.','latex',Cal.brw_str{Cal.n_inst});
Cal.dir_figs=fullfile('latex',filesep(),Cal.brw_str{Cal.n_inst},...
                              filesep(),[Cal.brw_str{Cal.n_inst},'_figures'],filesep());
mkdir(Cal.dir_figs);

try
      save(Cal.file_save,'-Append','Cal'); %sobreescribimos la configuracion guardada.
catch exception
      fprintf('Error: %s\n Initializing data for Brewer %s\n',exception.message,Cal.brw_name{Cal.n_inst});
      save(Cal.file_save);
end

%% configuration files
close all
[config_def,TCdef,DTdef,ETCdef,A1def,ATdef]=read_icf(Cal.brw_config_files{Cal.n_inst,2});
[config_orig,TCorig,DTorig,ETCorig,A1orig,ATorig]=read_icf(Cal.brw_config_files{Cal.n_inst,1});

Station.OSC=680;
Station.name='';
Station.lat=67;
Station.long=50;
Station.meanozo=350;

cal_step={}; sc_avg={}; sc_raw={}; Args={};

%% Sun_scan: Before Campaign
close all
[cal_step{1},sc_avg{1},sc_raw{1},Args{1}]=sc_report(Cal.brw_str{Cal.n_inst},Cal.brw_config_files{Cal.n_inst,1},...
                     'date_range',datenum(Cal.Date.cal_year,1,[1 159]),...
                     'CSN_orig',config_orig(14),'OSC',Station.OSC,...
                     'control_flag',1,'residual_limit',35,...
                     'hg_time',15,'one_flag',1);

%% Sun_scan: Campaign
[cal_step{2},sc_avg{2},sc_raw{2},Args{2}]=sc_report(Cal.brw_str{Cal.n_inst},Cal.brw_config_files{Cal.n_inst,2},...
                     'date_range',datenum(Cal.Date.cal_year,1,Cal.calibration_days{Cal.n_inst,1}([1 end])),...
                     'CSN_orig',config_def(14),'OSC',Station.OSC,...
                     'control_flag',1,'residual_limit',15,...
                     'hg_time',5,'one_flag',1);

%%
ix=sort(findobj('tag','SC_INDIVIDUAL')); figure(ix); set(get(gca,'title'),'FontSize',8);
printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'FontSize',.9,'Width',8.5,'Height',7);

ix=sort(findobj('tag','Final_SC_Calculation'));
if length(ix)>1
    Width=8; Height=6;
    for i=1:length(ix), figure(ix(i)); set(get(gca,'title'),'FontSize',8); end
else
    Width=13; Height=8;
end
printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'Width',Width,'Height',Height);

close all

%% Definicion de variables: SC
if length(cal_step)>1
   d_p=[length(cal_step)-1 length(cal_step)];   tags={'','new'};
else
   d_p=1;   tags={'new'};
end

idx=1; cal_step_error={};
for t=d_p % Siempre el pen�ltimo y �ltimo procesados (si hay m�s de uno)
     cal_step_error{t}=round(mean([abs(cal_step{t}(2)-cal_step{t}(3)),abs(cal_step{t}(2)-cal_step{t}(4))]));
     latexcmd(fullfile(Cal.file_latex,['cal_wavelengthSC',tags{idx},'_',Cal.brw_str{Cal.n_inst}]),...
                                      ['\numSC',tags{idx}],size(sc_avg{t},1),...
                                      ['\CALCSTEP',tags{idx}],round(cal_step{t}(1)),...
                                      ['\calsteperror',tags{idx}],cal_step_error{t});
     idx=idx+1;
end
sunscan{Cal.n_inst}.cal_step=cal_step;
sunscan{Cal.n_inst}.cal_step_error=cal_step_error;
sunscan{Cal.n_inst}.sc_avg=sc_avg; sunscan{Cal.n_inst}.sc_raw=sc_raw;
sunscan{Cal.n_inst}.info=Args;
save(Cal.file_save,'-APPEND','sunscan');

%% dsp calibration
res={}; detail={}; DSP_QUAD={}; QUAD_SUM={}; QUAD_DETAIL={};
CUBIC_SUM={}; CUBIC_DETAIL={}; salida={}; CSN_icf={};

l=dir(fullfile('DSP',[Cal.brw_str{Cal.n_inst},'*']));
ldsp=cellstr(cat(1,l.name));
ldsp=ldsp(end-3:end)
for jj=1:length(ldsp)  %% ojo solo funciona si config es igual para todos
    %%
%    if jj==length(ldsp),confign=2; else confign=1; end
    try
      [res{jj},detail{jj},DSP_QUAD{jj},QUAD_SUM{jj},QUAD_DETAIL{jj},...
       CUBIC_SUM{jj},CUBIC_DETAIL{jj},salida{jj},CSN_icf{jj},...
       ]=dspreport(Cal,'dsp_dir',fullfile('DSP',ldsp{jj}),'config_n',1);%
    catch
       warning(sprintf('Error en %s. DSP: %s',Cal.brw_name{Cal.n_inst},ldsp{jj}));
       res{jj}=NaN*ones(15,9,2); detail{jj}=NaN*ones(7,6,15,2); QUAD_DETAIL{jj}=NaN;
       %res{jj}=NaN*ones(9,7,2); detail{jj}=NaN*ones(6,6,9,2); QUAD_DETAIL{jj}=NaN;
    end
end
% Para salvar los datos de cada brewer
dates=sscanf(cell2str(cat(2,ldsp')),'%03d_%03d_%03d,',[3,Inf]);
dates=datejul(dates(2:3,:)');dates=dates(:,1);
dsp_summary{Cal.n_inst}.info=cellstr(datestr(dates))';
dsp_summary{Cal.n_inst}.res=res;
dsp_summary{Cal.n_inst}.detail=detail;
dsp_summary{Cal.n_inst}.salida=salida;

save(Cal.file_save,'-APPEND','dsp_summary');

%%
ix=sort(findobj('tag','DSP_QUAD_RES'));
printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix);

close all

%% Tabla - resumen con resultados DSP y Umkehr
 QUAD_SUM_table={}; rows={}; tabla_QuadSum={}; format short g;
 if config_orig(14)~=config_def(14)
    idx=1:length(res)+1; idx(end-1)=0; idx(end)=length(res);
    for t=[1:length(res)-1,length(res)+1]
        tabla_QuadSum{t}=num2cell(round(res{idx(t)}(end-1,:,1)*10^4)/10^4);
    end
    tabla_QuadSum{length(res)}=num2cell(round(res{length(res)}(res{length(res)}(:,1,1)==config_orig(14),:,1)*10^4)/10^4);
    Q_SUM_table_RowLabels={'Current',dsp_summary{Cal.n_inst}.info{:},dsp_summary{Cal.n_inst}.info{end},'Final'};
 else
    for t=1:length(res)
        tabla_QuadSum{t}=num2cell(round(res{t}(end-1,:,1)*10^4)/10^4);
    end
    Q_SUM_table_RowLabels={'Current',dsp_summary{Cal.n_inst}.info{:},'Final'};
 end

 tabla_QuadSum_str=cat(1,tabla_QuadSum{:});

 data_ini=cellfun(@(x) (round(x(:,1)*10^4))/10^4,{config_orig(8),config_orig(9),config_orig(10)},'UniformOutput',false);
 data_fin=cellfun(@(x) (round(x(:,1)*10^4))/10^4,{config_def(8),config_def(9),config_def(10)},'UniformOutput',false);
 QUAD_SUM_table=[{config_orig(14),data_ini{:}}   % Current
                 tabla_QuadSum_str(:,[1 2 4 5])  % Calculated
                 {config_def(14),data_fin{:}}];  % Final
 disp([Q_SUM_table_RowLabels',QUAD_SUM_table]);

label_1={'slit\#0','slit\#1','slit\#2','slit\#3','slit\#4','slit\#5'};
UMK_TABLE={};
 for um=1:length(res)
    steps_umk=res{um}(end-1:end,1,1);

    UMK_TABLE{um}=[];
    for iumk=1:2
      label_2={sprintf('step= %d ',fix(steps_umk(iumk)));'WL(A)';'Res(A)';'O3abs(1/cm)';'Ray abs(1/cm)'};
      if iumk==2, dumk=0; else dumk=iumk; end

      data=[label_2,[label_1;num2cell([round(detail{um}(1,:,end-dumk,1));detail{um}(2:4,:,end-dumk,1)])]];
      UMK_TABLE{um}=[UMK_TABLE{um};data];
    end
 end

%% Tablas y ficheros de definiciones latex
 indx=1;
for t=1:length(res)
    if t==1 indx=[]; else indx=t-1; end
% Se mantienen todas las tablas detalladas (tantas como test's analizados: 0, 1, 2, ...), por si se requieren en el futuro
    matrix2latex_QDETAIL(QUAD_DETAIL{t},...
                      fullfile(Cal.file_latex,['table_QDETAIL',num2str(indx),'_',Cal.brw_str{Cal.n_inst},'.tex']),...
                      'alignment','c','resize',0.9,'size','footnotesize');
% Idem para umkehr
     matrix2latex_ctable(UMK_TABLE{t},...
                      fullfile(Cal.file_latex,['table_UMK',num2str(indx),'_',Cal.brw_str{Cal.n_inst},'.tex']),...
                      'alignment','c','resize',0.9,'size','footnotesize');
end
% Una unica tabla - resumen
matrix2latex_ctable(QUAD_SUM_table,fullfile(Cal.file_latex,['table_dsp','_',Cal.brw_str{Cal.n_inst},'.tex']),...
            'Columnlabels',{'Calc-step', 'O3abs coeff.', 'SO2abs coeff.', 'O3/SO2'},...
            'RowLabels', Q_SUM_table_RowLabels,'alignment', 'c',...
            'resize',0.8,'format',{'%d','%6.4f','%6.4f','%6.4f'},'size','footnotesize');

% Definicion de variables
if length(res)>1
   d_p=[length(res)-1 length(res)];   tags={'','new'};
else
   d_p=1;   tags={'new'};
end

idx=1;
for t=d_p % Siempre el pen�ltimo y �ltimo procesados (si hay m�s de uno)
               % Solo vale para dos test's !!
     latexcmd(fullfile(Cal.file_latex,['cal_wavelengthDSP',tags{idx},'_',Cal.brw_str{Cal.n_inst}]),...
                                      ['\Auno',tags{idx}],round(res{t}(end-1,2,1)*10000)/10000,...% O3
                                      ['\Ados',tags{idx}],round(res{t}(end-1,4,1)*10000)/10000,...% ratio? MAL
                                      ['\Atres',tags{idx}],round(res{t}(end-1,5,1)*10000)/10000,...% SO2
                                      ['\UMKoffset',tags{idx}],fix(res{t}(end,1)));
     idx=idx+1;
 end

%% Eto para escribir resultados a hoja excel.
%  for dsps=1:length(ldsp)
%      legend1={'step',sprintf('ICF (%d, %d)',CSN_icf{dsps}(1),CSN_icf{dsps}(3)),'abs step','A1 Q','A1 S'};
%       dsp_table=NaN*ones(9,size(legend1,2));
%       dsp_table(:,1:5)=[res{dsps}(:,1,1),NaN*ones(9,1),res{dsps}(:,1,1)+salida{dsps}{1}.cal_ozonepos,...
%                         res{dsps}(:,2,1)*10000,res{dsps}(:,2,2)*10000];
%       dsp_table(end-1,2)=CSN_icf{dsps}(2)*10000;
%
%       aux=round(dsp_table); aux(:,[2 4 5])=aux(:,[2 4 5])/10000;
%       aux=[legend1;num2cell(aux)];
%       cell2str(aux,'\t')
%       xlswrite('./DSP/dsp_todo.xls',ldsp(dsps),Cal.brw_name{Cal.n_inst},['A',num2str(1+(dsps-1)*11)]);
%       xlswrite('./DSP/dsp_todo.xls',aux,Cal.brw_name{Cal.n_inst},['B',num2str(1+(dsps-1)*11)]);
%  end
%       xlswrite('./DSP/dsp_IZO2.xls',[Q_SUM_table_RowLabels',QUAD_SUM_table],[Cal.brw_name{Cal.n_inst},'_sum']);
%

##### SOURCE END #####
--></body></html>