
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>cal_report_185a2</title><meta name="generator" content="MATLAB 9.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-05-24"><meta name="DC.source" content="cal_report_185a2.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Brewer Setup</a></li><li><a href="#3">configuration files</a></li><li><a href="#4">Temperature dependence.  During campaign</a></li><li><a href="#9">Check previous results</a></li><li><a href="#10">SL summary from bfiles temperature</a></li><li><a href="#13">Check changes</a></li><li><a href="#15">Latex stuff</a></li><li><a href="#16">Filter attenuation</a></li></ul></div><pre class="codeinput"><span class="comment">% options_pub.outputDir=fullfile(pwd,'latex','185','html'); options_pub.showCode=true;</span>
<span class="comment">% publish(fullfile(pwd,'cal_report_185a2.m'),options_pub);</span>
</pre><h2 id="2">Brewer Setup</h2><pre class="codeinput">clear <span class="string">all</span>;

file_setup=<span class="string">'arenos2019_setup'</span>;

eval(file_setup);     <span class="comment">% configuracion por defecto</span>
Cal.n_inst=find(Cal.brw==185);
Cal.file_latex=fullfile(<span class="string">'.'</span>,<span class="string">'latex'</span>,Cal.brw_str{Cal.n_inst});
Cal.dir_figs=fullfile(<span class="string">'latex'</span>,filesep(),Cal.brw_str{Cal.n_inst},<span class="keyword">...</span>
                              filesep(),[Cal.brw_str{Cal.n_inst},<span class="string">'_figures'</span>],filesep());
mkdir(Cal.dir_figs);

<span class="keyword">try</span>
      save(Cal.file_save,<span class="string">'-Append'</span>,<span class="string">'Cal'</span>); <span class="comment">%sobreescribimos la configuracion guardada.</span>
      load(Cal.file_save);
<span class="keyword">catch</span> exception
      fprintf(<span class="string">'Error: %s\n Initializing data for Brewer %s\n'</span>,exception.message,Cal.brw_name{Cal.n_inst});
      save(Cal.file_save);
<span class="keyword">end</span>

load(Cal.file_save,<span class="string">'temperature'</span>);
load(Cal.file_save,<span class="string">'filter'</span>);
</pre><pre class="codeoutput">ans =
  logical
   1
ans =
  1&times;1 cell array
    {'IZO#185'}
ans =
  20&times;9 cell array
  Columns 1 through 5
    {'TSK#005'}    {[  5]}    {[2]}    {[0]}    {'005'}
    {'IOS#017'}    {[ 17]}    {[2]}    {[0]}    {'017'}
    {'SCO#033'}    {[ 33]}    {[2]}    {[0]}    {'033'}
    {'MAD#070'}    {[ 70]}    {[4]}    {[0]}    {'070'}
    {'UM#075' }    {[ 75]}    {[4]}    {[0]}    {'075'}
    {'MUR#117'}    {[117]}    {[4]}    {[0]}    {'117'}
    {'UM#126' }    {[126]}    {[4]}    {[0]}    {'126'}
    {'ARE#150'}    {[150]}    {[3]}    {[0]}    {'150'}
    {'COR#151'}    {[151]}    {[4]}    {[0]}    {'151'}
    {'K&amp;Z#158'}    {[158]}    {[3]}    {[0]}    {'158'}
    {'WRC#163'}    {[163]}    {[3]}    {[0]}    {'163'}
    {'ZAR#166'}    {[166]}    {[4]}    {[0]}    {'166'}
    {'UM#172' }    {[172]}    {[3]}    {[0]}    {'172'}
    {'JAP#174'}    {[174]}    {[3]}    {[0]}    {'174'}
    {'IZO#185'}    {[185]}    {[3]}    {[0]}    {'185'}
    {'MAD#186'}    {[186]}    {[3]}    {[0]}    {'186'}
    {'CAN#190'}    {[190]}    {[3]}    {[0]}    {'190'}
    {'TAM#201'}    {[201]}    {[3]}    {[0]}    {'201'}
    {'DNK#202'}    {[202]}    {[3]}    {[0]}    {'202'}
    {'DNK#228'}    {[228]}    {[3]}    {[0]}    {'228'}
  Columns 6 through 9
    {'..\005\ICF15117&#8230;'}    {'..\005\ICF15117&#8230;'}    {'1838'}    {'1838'}
    {'..\017\ICF15315&#8230;'}    {'..\017\ICF15315&#8230;'}    {'2170'}    {'2097'}
    {'..\033\ICF15617&#8230;'}    {'..\033\ICF15617&#8230;'}    {'2325'}    {'2325'}
    {'..\070\ICF15617&#8230;'}    {'..\070\ICF15617&#8230;'}    {'1707'}    {'1707'}
    {'..\075\ICF15017&#8230;'}    {'..\075\ICF15017&#8230;'}    {'1714'}    {'1714'}
    {'..\117\icf14915&#8230;'}    {'..\117\ICF14915&#8230;'}    {'1536'}    {'1612'}
    {'..\126\icf15517&#8230;'}    {'..\126\ICF15517&#8230;'}    {'1710'}    {'1710'}
    {'..\150\ICF15617&#8230;'}    {'..\150\ICF15617&#8230;'}    {'0322'}    {'0322'}
    {'..\151\ICF15317&#8230;'}    {'..\151\ICF15317&#8230;'}    {'1832'}    {'1832'}
    {'..\158\ICF21218&#8230;'}    {'..\158\ICF21218&#8230;'}    {'0558'}    {'0558'}
    {'..\163\ICF20118&#8230;'}    {'..\163\ICF20118&#8230;'}    {'0274'}    {'0274'}
    {'..\166\icf15215&#8230;'}    {'..\166\ICF15215&#8230;'}    {'1952'}    {'1975'}
    {'..\172\ICF15117&#8230;'}    {'..\172\ICF15117&#8230;'}    {'0444'}    {'0444'}
    {'..\174\ICF20718&#8230;'}    {'..\174\ICF20718&#8230;'}    {'0605'}    {'0605'}
    {'..\185\config18&#8230;'}    {'..\185\config18&#8230;'}    {'0335'}    {'0335'}
    {'..\186\ICF14915&#8230;'}    {'..\186\ICF14915&#8230;'}    {'0317'}    {'0317'}
    {'..\190\ICF11419&#8230;'}    {'..\190\ICF11419&#8230;'}    {'0410'}    {'0410'}
    {'..\201\ICF14315&#8230;'}    {'..\201\ICF14315&#8230;'}    {'0320'}    {'0320'}
    {'..\202\ICF15017&#8230;'}    {'..\202\ICF15017&#8230;'}    {'0270'}    {'0270'}
    {'..\228\ICF15017&#8230;'}    {'..\228\ICF15017&#8230;'}    {'0242'}    {'0242'}
XLSREAD unable to read sheet 'Incidencias.075'.
Requested sheet: 'Incidencias.075' not found.
 BrewerUM#075
</pre><h2 id="3">configuration files</h2><pre class="codeinput">close <span class="string">all</span>;

[config_def,TCdef,DTdef,ETCdef,A1def,ATdef]=read_icf(Cal.brw_config_files{Cal.n_inst,2});
[config_orig,TCorig,DTorig,ETCorig,A1orig,ATorig]=read_icf(Cal.brw_config_files{Cal.n_inst,1});

config_temp.n_inst=Cal.n_inst;
config_temp.brw_name=Cal.brw_name{Cal.n_inst};
config_temp.final_days=Cal.Date.FINAL_DAYS(1);

NTC={}; tabla_regress={}; ajuste={}; Args={};
</pre><h2 id="4">Temperature dependence.  During campaign</h2><pre class="codeinput">[sl_rw,tc]=readb_sl_rawl(fullfile(<span class="string">'.'</span>,<span class="string">'bfiles'</span>,[<span class="string">'B*.'</span>,Cal.brw_str{Cal.n_inst}]));<span class="comment">% cambio nombres para poder seguir</span>

<span class="keyword">if</span> ~isnan(sl_rw)
</pre><pre class="codeinput">    [NTC{1},ajuste{1},Args{1},Fr]=temp_coeff_raw(config_temp,sl_rw,<span class="string">'outlier_flag'</span>,0,<span class="keyword">...</span>
        <span class="string">'date_range'</span>,datenum(Cal.Date.cal_year,1,Cal.calibration_days{Cal.n_inst,1}([1 end])));

    disp(sprintf(<span class="string">' ORIG MS9: %5.0f +/-%2.0f  %3.1f +/- %3.2f  '</span>,ajuste{1}.orig(7,[1 3 2 4])));
    disp(sprintf(<span class="string">'  NEW MS9: %5.0f +/-%2.0f  %3.1f +/- %3.2f  '</span>,ajuste{1}.new(7,[1 3 2 4])));
</pre><pre class="codeinput">    makeHtmlTable([ajuste{1}.cero(:,[1 3]) ajuste{1}.cero(:,[2 4])],[],<span class="keyword">...</span>
        {<span class="string">'slit#2'</span>,<span class="string">'slit#3'</span>,<span class="string">'slit#4'</span>,<span class="string">'slit#5'</span>,<span class="string">'slit#6'</span>,<span class="string">'R5'</span>,<span class="string">'R6'</span>},{<span class="string">'a'</span>,<span class="string">'a SE'</span>,<span class="string">'b'</span>,<span class="string">'b SE'</span>},[],4);
</pre><pre class="codeinput">    makeHtmlTable(NTC{1});
</pre><pre class="codeinput"><span class="keyword">else</span>
    Fr=NaN*ones(1,9);
    ajuste{1}.orig=NaN*ones(7,4);
    ajuste{1}.cero=NaN*ones(7,4);
    ajuste{1}.new=NaN*ones(7,4);

<span class="keyword">end</span>
</pre><pre class="codeoutput">No B Files
</pre><h2 id="9">Check previous results</h2><pre class="codeinput"><span class="keyword">if</span> exist(<span class="string">'sl_raw'</span>,<span class="string">'var'</span>)
    <span class="keyword">if</span> iscell(sl_raw) &amp;&amp; size(sl_raw,2)&gt;=Cal.n_inst
        <span class="keyword">if</span> isempty(sl_raw{Cal.n_inst})
           [sl_raw{Cal.n_inst},TC{Cal.n_inst}]=readb_sl_rawl(fullfile([<span class="string">'bdata'</span>,Cal.brw_str{Cal.n_inst}],<span class="keyword">...</span>
                                                             [<span class="string">'B*.'</span>,Cal.brw_str{Cal.n_inst}]),<span class="string">'f_plot'</span>,1);
           save(Cal.file_save,<span class="string">'-APPEND'</span>,<span class="string">'sl_raw'</span>,<span class="string">'TC'</span>);
        <span class="keyword">end</span>
    <span class="keyword">else</span>
        [sl_raw{Cal.n_inst},TC{Cal.n_inst}]=readb_sl_rawl(fullfile([<span class="string">'bdata'</span>,Cal.brw_str{Cal.n_inst}],<span class="keyword">...</span>
                                                          [<span class="string">'B*.'</span>,Cal.brw_str{Cal.n_inst}]),<span class="string">'f_plot'</span>,1);
        save(Cal.file_save,<span class="string">'-APPEND'</span>,<span class="string">'sl_raw'</span>,<span class="string">'TC'</span>);
    <span class="keyword">end</span>
<span class="keyword">else</span>
    [sl_raw{Cal.n_inst},TC{Cal.n_inst}]=readb_sl_rawl(fullfile([<span class="string">'bdata'</span>,Cal.brw_str{Cal.n_inst}],<span class="keyword">...</span>
                                                      [<span class="string">'B*.'</span>,Cal.brw_str{Cal.n_inst}]),<span class="string">'f_plot'</span>,1);
    save(Cal.file_save,<span class="string">'-APPEND'</span>,<span class="string">'sl_raw'</span>,<span class="string">'TC'</span>);
<span class="keyword">end</span>
</pre><pre class="codeoutput">processing sl files: 60%     [......    ]ans =
    'summary      5:05:16 PM      Mar       27/      19      61.396      2.067      19      zs      0      710      872      -14504      545      -1034      7198      -218      467      3062      2468      3268      4089      15358      7836      235      1084           '
ans =
    'summary      6:05:45 PM      Mar       27/      19      74.259      3.548      20      zs      0      -348      -1726      418      281      -1247      -2412      108      -285      3233      2204      2425      2059      9295      3700      65      164           '
ans =
    'summary      6:33:07 PM      Mar       27/      19      80.459      5.455      20      zs      0      876      1204      512      223      162      569      -158      373      2116      2449      3009      4666      15972      8820      117      488           '
ans =
    'summary      6:47:31 PM      Mar       27/      19      83.539      7.268      20      zs      0      3168      2634      3532      -3007      12789      5979      -806      2046      4749      3126      4210      3160      13815      6253      292      816           '
ans =
    'summary      6:53:16 PM      Mar       27/      19      84.746      8.246      20      zs      0      -441      1522      -305      632      -2464      600      -4898      11487      3749      3313      3523      5351      18243      10577      3667      8539           '
ans =
    'summary      6:59:02 PM      Mar       27/      19      85.944      9.368      19      zs      0      -401      157      272      568      -2220      -946      9758      -22952      3226      1792      1303      3612      13660      5450      9285      21839           '
ans =
    'summary      7:04:48 PM      Mar       27/      19      87.127      10.549      19      zs      0      828      845      2689      -880      3643      996      2429      -5680      5878      5146      3641      2741      13229      7638      334      854           '
ans =
    'summary      7:17:45 PM      Mar       27/      19      89.969      12.012      19      zs      0      2717      1510      1225      -2745      11502      5564      1626      -3738      3965      4807      5427      3308      14400      7262      14      115           '
ans =
    'summary      7:23:31 PM      Mar       27/      19      91.526      11.476      19      zs      0      264      -232      -441      526      -1419      -905      1818      -4283      1810      1537      2050      1391      2780      2003      97      235           '
ans =
    'summary      7:56:38 PM      Mar       27/      19      98.639      5.848      19      zs      0      1343      792      -332      457      -120      181      -126      293      4056      2922      2658      3066      11477      5416      64      137           '
ans =
    'summary      8:00:57 PM      Mar       27/      19      99.817      5.292      20      sl      0      1938      1317      428      437      541      361      752291      1282615      5      4      3      3      15      8      388      344           '
ans =
    'summary      8:15:21 PM      Mar       27/      19      102.721      4.265      19      zs      0      -805      212      -2085      243      -1581      842      69      -195      2265      4139      3230      1234      4285      2382      40      20           '
ans =
    'summary      8:47:02 PM      Mar       27/      19      109.604      2.904      20      sl      0      1943      1317      429      436      549      362      750230      1280291      5      2      3      5      19      10      834      870           '
ans =
    'summary      10:58:04 PM      Mar       27/      19      135.547      1.396      20      sl      0      1943      1319      431      433      556      367      749878      1279066      3      2      2      4      16      7      328    61%     [......    ]ans =
    'summary      11:06:43 AM      Mar       28/      19      -38.721      1.279      20      zs      0      -956      871      -572      999      -4152      -541      103      -528      3198      2306      2017      2244      5978      2586      132      650           '
ans =
    'summary      6:36:00 PM      Mar       28/      19      80.960      5.694      20      zs      0      -511      -646      -480      1312      -4709      -2636      -153      290      2589      3877      3478      3138      11141      6290      63      262           '
ans =
    'summary      6:50:24 PM      Mar       28/      19      84.018      7.636      20      zs      0      2843      2358      2328      -2162      9760      4868      -1361      3310      2818      3340      3397      2961      10297      6660      481      1114           '
ans =
    'summary      6:56:09 PM      Mar       28/      19      85.212      8.666      20      zs      0      -1165      -1979      -2315      0      -1165      -821      -7286      17110      3082      2808      3028      0      3082      3573      27778      65251           '
ans =
    'summary      7:01:55 PM      Mar       28/      19      86.395      9.818      20      zs      0      830      1673      2521      -1758      6455      3401      3850      -8995      6386      2437      3290      3005      14529      5306      1112      2703           '
ans =
    'summary      7:07:40 PM      Mar       28/      19      87.559      10.958      20      zs      0      2045      496      551      -608      3990      1254      2090      -4881      2765      2404      1270      2281      9071      4843      182      473           '
ans =
    'summary      7:23:31 PM      Mar       28/      19      91.491      11.501      20      zs      0      625      1080      735      69      403      594      1801      -4229      3573      2752      3167      4947      18113      9321      96      303           '
ans =
    'summary      7:35:02 PM      Mar       28/      19      94.038      9.211      20      zs      0      -531      1532      1979      -64      -328      651      3533      -8305      2339      1915      1632      3698      12835      6653      23795      55845           '
ans =
    'summary      7:40:48 PM      Mar       28/      19      95.215      8.149      20      zs      0      597      -390      -996      763      -1845      -1189      -3545      8314      4320      4289      4636      4702      19047      9930      2182      5062           '
ans =
    'summary      7:46:33 PM      Mar       28/      19      96.392      7.226      20      zs      0      1393      1227      1645      278      504      -68      -658      1552      2831      2413      4505      5371      18633      9024      209      588           '
ans =
    'summary      7:52:19 PM      Mar       28/      19      97.565      6.448      20      zs      0      -305      -818      444      1846      -6212      -4178      -295      603      3100      3512      1648      3515      14056      7362      84      292           '
ans =
    'summary      8:06:43 PM      Mar       28/      19      100.737      4.921      20      zs      0      -2675      -747      -3593      -166      -2142      1333      -17      1      3360      2528      2598      440      3586      2729      42      106           '
ans =
    'summary      8:11:02 PM      Mar       28/      19      101.905      4.513      20      zs      0      1843      2055      1932      1794      -3897      -1961      27      -141      3330      3366      3367      1805      5738      3565      48      23           '
ans =
    'summary      8:41:16 PM      Mar       28/      19      108.237      3.099      20      sl      0      1939      1318      428      437      542      361      751321      1281312      4      3      4      3      12      6      384      251           '
ans =
    'summary      10:01:55 PM      Mar       28/      19      124.874      1.737      21      sl      0      1943      1319      432      434      555      366      749566      1278681      3      3      2      1      6      4      684      434           '
Dot indexing is not supported for variables of this typ62%     [......    ]Dot indexing is not supported for variables of this typ63%     [......    ]Dot indexing is not supported for variables of this typ100%    [..........] sl raw done
</pre><img vspace="5" hspace="5" src="cal_report_185a2_01.png" alt=""> <img vspace="5" hspace="5" src="cal_report_185a2_02.png" alt=""> <h2 id="10">SL summary from bfiles temperature</h2><p>figure; set(gcf,'Tag','DailySL'); hl1=ploterr(TC{Cal.n_inst}(1,:),TC{Cal.n_inst}(2,:),[],TC{Cal.n_inst}(3,:),'*k'); set(hl1,'LineWidth',2); ylabel('SL double ratio MS9'); title(sprintf('Daily means for sl ozone ratio &amp; temperature. Brewer %s\r\n (from bfile sl summaries)',Cal.brw_name{Cal.n_inst})); set(gca,'XTickLabels',datestr(get(gca,'XTick'),2));  grid; ax(1)=gca; set(ax(1),'Position',[0.1  0.12  0.75  0.72]);% [left bottom width height] xtickangle(gca,30); ax(2)=axes('Position',get(ax(1),'Position'),...    'XAxisLocation','top',...    'YAxisLocation','right',...    'Color','none','FontSize',10,...    'XColor','k','YColor','b'); set(ax,'box','off'); hold on; hl2=ploterr(TC{Cal.n_inst}(1,:),TC{Cal.n_inst}(7,:),[],TC{Cal.n_inst}(8,:),'*b'); set(hl2,'LineWidth',2);  set(gca,'XTicklabels',[],'YLim',[0 45]); ylb=ylabel('Temperature','Rotation',-90); pos=get(ylb,'Position'); pos(1)=pos(1)+3; set(ylb,'Position',pos);</p><pre class="codeinput">[NTC{2},ajuste{2},Args{2},Fraw,Fnew]=temp_coeff_raw(config_temp,sl_raw{Cal.n_inst},<span class="string">'outlier_flag'</span>,1,<span class="keyword">...</span>
                       <span class="string">'date_range'</span>,datenum(Cal.Date.cal_year-2,7,15));   <span class="comment">% two years before calibration</span>
                        <span class="comment">%'date_range',datenum(Cal.Date.cal_year,1,[1,Cal.calibration_days{Cal.n_inst,1}(1)]));</span>
                        <span class="comment">%this year data</span>



<span class="comment">% figure(maxf(findobj('Tag','TEMP_OLD_VS_NEW'))); set(gca,'YLim',[1750 1920]);</span>

disp(sprintf(<span class="string">' ORIG MS9: %5.0f +/-%2.0f  %3.1f +/- %3.2f  '</span>,ajuste{2}.orig(7,[1 3 2 4])));
disp(sprintf(<span class="string">'  NEW MS9: %5.0f +/-%2.0f  %3.1f +/- %3.2f  '</span>,ajuste{2}.new(7,[1 3 2 4])));
</pre><pre class="codeoutput">--------- Validation OK --------------
List of arguments given default values:
   'plots'    defaults to 1
   'plot_flag'    defaults to 0
   'intensity_flag'    defaults to 0
   'temp_flag'    defaults to []
   'TCB'    defaults to []
   'N_TC'    defaults to []
--------------------------------------
 ORIG MS9:   373 +/- 0  -0.5 +/- 0.02  
  NEW MS9:   372 +/- 1  0.2 +/- 0.04  
</pre><img vspace="5" hspace="5" src="cal_report_185a2_03.png" alt=""> <img vspace="5" hspace="5" src="cal_report_185a2_04.png" alt=""> <img vspace="5" hspace="5" src="cal_report_185a2_05.png" alt=""> <img vspace="5" hspace="5" src="cal_report_185a2_06.png" alt=""> <img vspace="5" hspace="5" src="cal_report_185a2_07.png" alt=""> <pre class="codeinput">tc_reg_table=makeHtml_Table([ajuste{2}.cero(:,[1 3]) ajuste{2}.cero(:,[2 4])],[],<span class="keyword">...</span>
        {<span class="string">'slit#2'</span>,<span class="string">'slit#3'</span>,<span class="string">'slit#4'</span>,<span class="string">'slit#5'</span>,<span class="string">'slit#6'</span>,<span class="string">'R5'</span>,<span class="string">'R6'</span>},{<span class="string">'a'</span>,<span class="string">'a SE'</span>,<span class="string">'b'</span>,<span class="string">'b SE'</span>},[],4)
temperature{Cal.n_inst}.regression_table=tc_reg_table;
</pre><pre class="codeoutput">tc_reg_table =
  7&times;4 table
                a         aSE         b          bSE   
              ______    _______    ________    ________
    slit_2     57691     4.0029      26.765     0.20498
    slit_3     58302     4.0033      27.333       0.205
    slit_4     59214     3.9146      25.982     0.20046
    slit_5     59605     4.0357      28.049     0.20666
    slit_6     60035     4.0495      28.265     0.20737
    R5        548.05     1.5495    0.072669    0.079344
    R6        372.41    0.87684    -0.45796      0.0449
</pre><pre class="codeinput">tc_coeff_table=makeHtml_Table(NTC{2})
temperature{Cal.n_inst}.coeff_table=tc_coeff_table;
</pre><pre class="codeoutput">tc_coeff_table =
  1&times;5 table
    M1     M2       M3      M4       M5 
    __    _____    ____    _____    ____
    0     -0.57    0.78    -1.28    -1.5
</pre><h2 id="13">Check changes</h2><pre class="codeinput">[NTCx,ajustex,Argsx,Fraw,Forig]=temp_coeff_raw(config_temp,sl_raw{Cal.n_inst},<span class="string">'outlier_flag'</span>,1,<span class="string">'plots'</span>,0,<span class="keyword">...</span>
                                <span class="string">'N_TC'</span>,TCorig(1:5)',<span class="string">'date_range'</span>,datenum(Cal.Date.cal_year-2,1,[Cal.calibration_days{Cal.n_inst,1}(1)]));

Forigx=Forig; Fn=Fnew;

figure;  set(gcf,<span class="string">'Tag'</span>,<span class="string">'TEMP_COMP_DATE'</span>);
plot(Forigx(:,1),Forigx(:,2),<span class="string">'b.'</span>,<span class="string">'MarkerSize'</span>,6);
ylabel(<span class="string">'Temperature'</span>,<span class="string">'Color'</span>,<span class="string">'b'</span>); ax(1)=gca; set(ax(1),<span class="string">'YAxisLocation'</span>,<span class="string">'right'</span>,<span class="string">'XTicklabels'</span>,{<span class="string">' '</span>});
[mn,sn]=grpstats(Forigx(:,[1,end,2]),{year(Forigx(:,1)),fix(Forigx(:,1))},{<span class="string">'mean'</span>,<span class="string">'sem'</span>});
[mt,st]=grpstats(Fn(:,[1,end]),{year(Fn(:,1)),fix(Fn(:,1))},{<span class="string">'mean'</span>,<span class="string">'sem'</span>});
ax(2) = axes(<span class="string">'YAxisLocation'</span>,<span class="string">'left'</span>,<span class="string">'Color'</span>,<span class="string">'none'</span>);
hold <span class="string">all</span>; errorbar(mn(:,1),mn(:,2),sn(:,2),<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'Marker'</span>,<span class="string">'s'</span>);
errorbar(mt(:,1),mt(:,2),st(:,2),<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'Marker'</span>,<span class="string">'s'</span>);
errorbar(mt(:,1),mt(:,2),st(:,2),<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'Marker'</span>,<span class="string">'s'</span>);
title([<span class="string">'R6 Temperature dependence Brewer#'</span>, Cal.brw_str{Cal.n_inst}]); ylabel(<span class="string">'Standard Lamp R6 ratio'</span>);
datetick(<span class="string">'x'</span>,6,<span class="string">'KeepTicks'</span>,<span class="string">'KeepLimits'</span>); grid <span class="string">on</span>;
lg=legend(ax(2),<span class="string">'Old temperature coeff'</span>,<span class="string">'New temperature coeff'</span>,<span class="string">'Location'</span>,<span class="string">'best'</span>);
set(lg,<span class="string">'HandleVisibility'</span>,<span class="string">'Off'</span>);  set(findobj(lg,<span class="string">'Type'</span>,<span class="string">'text'</span>),<span class="string">'FontSize'</span>,7,<span class="string">'HandleVisibility'</span>,<span class="string">'Off'</span>);
linkprop(ax,{<span class="string">'Position'</span>,<span class="string">'XTick'</span>});

figure; set(gcf,<span class="string">'Tag'</span>,<span class="string">'TEMP_COMP_TEMP'</span>)
[mn,sn]=grpstats(Forigx(:,[2,end]),Forigx(:,2),{<span class="string">'mean'</span>,<span class="string">'sem'</span>});
[mt,st]=grpstats(Fn(:,[2,end]),Fn(:,2),{<span class="string">'mean'</span>,<span class="string">'sem'</span>});
hold <span class="string">on</span>; errorbar(mn(:,1),mn(:,2),sn(:,2),<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'Marker'</span>,<span class="string">'s'</span>);
errorbar(mt(:,1),mt(:,2),st(:,2),<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'Marker'</span>,<span class="string">'s'</span>); grid;
lg=legend(<span class="string">'Old temperature coeff'</span>,<span class="string">'New temperature coeff'</span>,<span class="string">'Location'</span>,<span class="string">'best'</span>);
set(lg,<span class="string">'HandleVisibility'</span>,<span class="string">'Off'</span>); set(findobj(lg,<span class="string">'Type'</span>,<span class="string">'text'</span>),<span class="string">'FontSize'</span>,7,<span class="string">'HandleVisibility'</span>,<span class="string">'Off'</span>);
title([<span class="string">'R6 Temperature dependence Brewer#'</span>, Cal.brw_str{Cal.n_inst}]);
ylabel(<span class="string">'Standard Lamp R6 ratio'</span>); xlabel(<span class="string">'Temperature'</span>); set(gca,<span class="string">'Box'</span>,<span class="string">'On'</span>);
</pre><pre class="codeoutput">--------- Validation OK --------------
List of arguments given default values:
   'plot_flag'    defaults to 0
   'intensity_flag'    defaults to 0
   'temp_flag'    defaults to []
   'TCB'    defaults to []
--------------------------------------
</pre><img vspace="5" hspace="5" src="cal_report_185a2_08.png" alt=""> <img vspace="5" hspace="5" src="cal_report_185a2_09.png" alt=""> <p>ix=sort(findobj('tag','TEMP_COEF_DESC')); printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'Width',15,'Height',7,'LockAxes',0,'no_export');</p><pre class="codeinput"><span class="comment">% ix=sort(findobj('tag','TEMP_day_new'));</span>
<span class="comment">% printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'Width',14,'Height',9,'LockAxes',0,'no_export');</span>

ix=sort(findobj(<span class="string">'tag'</span>,<span class="string">'TEMP_OLD_VS_NEW'</span>));
printfiles_report(ix',Cal.dir_figs,<span class="string">'aux_pattern'</span>,ix,<span class="string">'Width'</span>,12.5,<span class="string">'Height'</span>,6.5);

ix=sort(findobj(<span class="string">'tag'</span>,<span class="string">'TEMP_COMP_DATE'</span>));
printfiles_report(ix',Cal.dir_figs,<span class="string">'aux_pattern'</span>,ix,<span class="string">'Width'</span>,12.5,<span class="string">'Height'</span>,7,<span class="string">'FontMode'</span>,<span class="string">'fixed'</span>,<span class="string">'FontSize'</span>,9,<span class="string">'axes'</span>,1);

ix=sort(findobj(<span class="string">'tag'</span>,<span class="string">'TEMP_COMP_TEMP'</span>));
printfiles_report(ix',Cal.dir_figs,<span class="string">'aux_pattern'</span>,ix,<span class="string">'Width'</span>,12.5,<span class="string">'Height'</span>,6.5);

close <span class="string">all</span>
</pre><pre class="codeoutput">naux =
     1
naux =
     1
naux =
     1
</pre><h2 id="15">Latex stuff</h2><pre class="codeinput"><span class="comment">% Temperature Range</span>
<span class="comment">% Para que funcione asignamos la salida Fr en la llamada a la funci&yuml;n</span>
<span class="comment">% temp_coeff_raw donde se calculen los TC's (en este caso en {})</span>
tmp=Fr(:,2);
latexcmd(fullfile(Cal.file_latex,[<span class="string">'cal_tempcoeff_'</span>,Cal.brw_str{Cal.n_inst}]),<span class="keyword">...</span>
                                  <span class="string">'\tempmin'</span>,min(tmp),<span class="string">'\tempmax'</span>,max(tmp));
clear <span class="string">tmp</span>;
temperature{Cal.n_inst}.sl_raw=sl_raw{Cal.n_inst};
temperature{Cal.n_inst}.NTC=NTC;
temperature{Cal.n_inst}.ajuste=ajuste;
<span class="keyword">if</span> exist(<span class="string">'Args'</span>,<span class="string">'var'</span>)
temperature{Cal.n_inst}.info=Args;
<span class="keyword">else</span> warning(<span class="string">'No se est&yuml;n guardando los inputs de la funci&yuml;n!!'</span>)
<span class="keyword">end</span>
save(Cal.file_save,<span class="string">'-APPEND'</span>,<span class="string">'temperature'</span>);

<span class="comment">% Tables</span>
tc_table={};
 <span class="keyword">for</span> t=1:length(NTC)
    tc_table{t}=[round(config_orig(2:6)'*10^4)/10^4                             <span class="comment">%'Current'</span>
                       NTC{1}                                                   <span class="comment">%'Calculated'</span>
                 round(config_def(2:6)'*10^4)/10^4];                            <span class="comment">%'Final'</span>

    <span class="keyword">if</span> t==1, t=[]; indx=1;  <span class="keyword">else</span> t=t-1; indx=indx+1;  <span class="keyword">end</span>
       matrix2latex_ctable(tc_table{indx},<span class="keyword">...</span>
                     fullfile(Cal.file_latex,[<span class="string">'table_TC'</span>,num2str(t),<span class="string">'_'</span>,Cal.brw_str{Cal.n_inst},<span class="string">'.tex'</span>]),<span class="keyword">...</span>
                    <span class="string">'RowLabels'</span>,{<span class="string">'Current'</span>,<span class="string">'Calculated'</span>,<span class="string">'Final'</span>},<span class="keyword">...</span>
                    <span class="string">'ColumnLabels'</span>,{<span class="string">'slit#2'</span>,<span class="string">'slit#3'</span>,<span class="string">'slit#4'</span>,<span class="string">'slit#5'</span>,<span class="string">'slit#6'</span>},<span class="keyword">...</span>
                    <span class="string">'alignment'</span>, <span class="string">'c'</span>,<span class="string">'resize'</span>,0.8,<span class="string">'format'</span>,<span class="string">'%7.4f'</span>,<span class="string">'size'</span>,<span class="string">'footnotesize'</span>);
 <span class="keyword">end</span>

tabla_regress={};
 <span class="keyword">for</span> tt=1:length(ajuste)

     param=ajuste{tt};
     <span class="keyword">if</span> isstruct(param)
         param=param.new;
     <span class="keyword">end</span>
     absc=mmcellstr(sprintf(<span class="string">'%g +/- %g |'</span>,round(param([1:5 7],[1,3]))'));
     slpe=mmcellstr(sprintf(<span class="string">'%3.1f +/- %3.2f |'</span>,param([1:5 7],[2,4])'));
     tabla_regress{tt}=cat(2,absc,slpe);

     <span class="keyword">if</span> tt==1, tt=[]; indx=1;  <span class="keyword">else</span> tt=tt-1; indx=indx+1;  <span class="keyword">end</span>
        matrix2latex_ctable(tabla_regress{indx},<span class="keyword">...</span>
                fullfile(Cal.file_latex,[<span class="string">'table_regress'</span>,num2str(tt),<span class="string">'_'</span>,Cal.brw_str{Cal.n_inst},<span class="string">'.tex'</span>]),<span class="keyword">...</span>
               <span class="string">'RowLabels'</span>,{<span class="string">'slit\#2'</span>,<span class="string">'slit\#3'</span>,<span class="string">'slit\#4'</span>,<span class="string">'slit\#5'</span>,<span class="string">'slit\#6'</span>,<span class="string">'MS9'</span>},<span class="keyword">...</span>
               <span class="string">'ColumnLabels'</span>,{<span class="string">'0 abscissa +/- standard error'</span>,<span class="string">'slope +/- standard error'</span>},<span class="keyword">...</span>
               <span class="string">'alignment'</span>, <span class="string">'c'</span>,<span class="string">'resize'</span>,0.8,<span class="string">'size'</span>,<span class="string">'footnotesize'</span>);
 <span class="keyword">end</span>
</pre><h2 id="16">Filter attenuation</h2><pre class="codeinput">[ETC_FILTER_CORRECTION,media_fi,fi,fi_avg]=filter_rep(Cal.brw_str{Cal.n_inst},<span class="keyword">...</span>
                             <span class="string">'date_range'</span>,datenum(Cal.Date.cal_year-4,1,1),<span class="keyword">...</span>
                             <span class="string">'outlier_flag'</span>,1,<span class="string">'plot_flag'</span>,0,<span class="string">'config'</span>,config_orig(17:22));

filter{Cal.n_inst}.ETC_FILTER_CORRECTION=ETC_FILTER_CORRECTION;
filter{Cal.n_inst}.media_fi=media_fi;
filter{Cal.n_inst}.fi=fi;
filter{Cal.n_inst}.ETC_FILTER_COR=round(ETC_FILTER_CORRECTION(2,:).*(sign(ETC_FILTER_CORRECTION(3,:))==sign(ETC_FILTER_CORRECTION(4,:))));
filter{Cal.n_inst}.fi_avg=fi_avg;

    o3f=filters_data(filter,Cal);

save(Cal.file_save,<span class="string">'-APPEND'</span>,<span class="string">'filter'</span>);

NFI=size(fi,1);
NFIcamp=length(find(ismember(fi_avg(:,1),datenum(Cal.Date.cal_year,1,Cal.calibration_days{Cal.n_inst,1}))==1));
latexcmd(fullfile(Cal.file_latex,[<span class="string">'cal_filter_'</span>,Cal.brw_str{Cal.n_inst}]),<span class="string">'\NFI'</span>,NFI,<span class="string">'\NFIcamp'</span>,NFIcamp);

label_2={<span class="string">'filter #1'</span>,<span class="string">'filter #2'</span>,<span class="string">'filter #3'</span>,<span class="string">'filter #4'</span>,<span class="string">'filter #5'</span>};
ETC_FILTER_CORR2cell={};
<span class="keyword">for</span> y=1:5
    ETC_FILTER_CORR2cell{1,y}=round(ETC_FILTER_CORRECTION(1,y)*10)/10;
    ETC_FILTER_CORR2cell{2,y}=round(ETC_FILTER_CORRECTION(2,y)*10)/10;
    ETC_FILTER_CORR2cell{3,y}=sprintf(<span class="string">'%c%s %s%c'</span>,<span class="string">'['</span>,num2str(round(ETC_FILTER_CORRECTION(3,y)*10)/10),num2str(round(ETC_FILTER_CORRECTION(4,y)*10)/10),<span class="string">']'</span>);
<span class="keyword">end</span>
disp(ETC_FILTER_CORR2cell);
matrix2latex_ctable(ETC_FILTER_CORR2cell,fullfile(Cal.file_latex,[<span class="string">'table_filter_correction_'</span>,Cal.brw_str{Cal.n_inst},<span class="string">'.tex'</span>]),<span class="keyword">...</span>
                     <span class="string">'rowLabels'</span>,{<span class="string">'ETC Filt. Corr. (median)'</span>,<span class="string">'ETC Filt. Corr. (mean)'</span>,<span class="string">'ETC Filt. Corr. (mean 95\% CI) '</span>},<span class="keyword">...</span>
                     <span class="string">'columnLabels'</span>,{<span class="string">'filter\#1'</span>,<span class="string">'filter\#2'</span>,<span class="string">'filter\#3'</span>,<span class="string">'filter\#4'</span>,<span class="string">'filter\#5'</span>},<span class="keyword">...</span>
                     <span class="string">'alignment'</span>, <span class="string">'c'</span>,<span class="string">'resize'</span>,0.8);

label_1={<span class="string">'slit #0'</span>,<span class="string">'slit #1'</span>,<span class="string">'slit #2'</span>,<span class="string">'slit #3'</span>,<span class="string">'slit #4'</span>,<span class="string">'slit #5'</span>,<span class="string">'mean'</span>};
label_2={<span class="string">'filter #1'</span>,<span class="string">'filter #2'</span>,<span class="string">'filter #3'</span>,<span class="string">'filter #4'</span>,<span class="string">'filter #5'</span>};
<span class="comment">% disp([num2cell(media_fi);num2cell(fix(mean(media_fi)))]);</span>
matrix2latex_ctable([num2cell(media_fi);num2cell(fix(mean(media_fi)))],fullfile(Cal.file_latex,[<span class="string">'table_filter_'</span>,Cal.brw_str{Cal.n_inst},<span class="string">'.tex'</span>]),<span class="keyword">...</span>
                     <span class="string">'rowLabels'</span>,{<span class="string">'slit\#0'</span>,<span class="string">'slit\#1'</span>,<span class="string">'slit\#2'</span>,<span class="string">'slit\#3'</span>,<span class="string">'slit\#4'</span>,<span class="string">'slit\#5'</span>,<span class="string">'mean'</span>},<span class="keyword">...</span>
                     <span class="string">'columnLabels'</span>,{<span class="string">'filter\#1'</span>,<span class="string">'filter\#2'</span>,<span class="string">'filter\#3'</span>,<span class="string">'filter\#4'</span>,<span class="string">'filter\#5'</span>},<span class="keyword">...</span>
                     <span class="string">'alignment'</span>, <span class="string">'c'</span>,<span class="string">'resize'</span>,0.72);
</pre><pre class="codeoutput">./bdata185/FIOAVG.185
Error using read_avg_line (line 19)
fichero no encontrado./bdata185/FIOAVG.185
</pre><pre class="codeoutput error">Output argument "ETC_FILTER_CORRECTION" (and maybe others) not assigned during call to "filter_rep".
Error in cal_report_185a2 (line 224)
[ETC_FILTER_CORRECTION,media_fi,fi,fi_avg]=filter_rep(Cal.brw_str{Cal.n_inst},...</pre><pre class="codeinput">fprintf(<span class="string">'\nFI''s analyzed: %d\n'</span>,NFI);
fi_mean_table=display_table([fix(media_fi);fix(mean(media_fi))],label_2,10,<span class="string">'.5g'</span>,label_1)
filter{Cal.n_inst}.mean_table=fi_mean_table;
<span class="comment">%</span>
<span class="comment">%fprintf('\nFI''s analyzed: %d\n',NFI);</span>
fi_etc_table=display_table(ETC_FILTER_CORRECTION,label_2,10,<span class="string">'.5g'</span>,{<span class="string">'ETC Filt. Corr. (median)'</span>,<span class="string">'ETC Filt. Corr. (mean)'</span>,<span class="string">'ETC Filt. Corr. (CI) '</span>,<span class="string">'ETC Filt. Corr.(CI)'</span>})
filter{Cal.n_inst}.etc_table=fi_etc_table;


save(Cal.file_save,<span class="string">'-APPEND'</span>,<span class="string">'filter'</span>);
</pre><pre class="codeinput"> figure(maxf(findobj(<span class="string">'tag'</span>,<span class="string">'FI_wavelength'</span>)));
 printfiles_report(gcf,Cal.dir_figs,<span class="string">'Width'</span>,13.5);

 figure(maxf(findobj(<span class="string">'tag'</span>,<span class="string">'FI_STATS'</span>)));
 printfiles_report(gcf,Cal.dir_figs,<span class="string">'Width'</span>,13,<span class="string">'Height'</span>,16);

 ix=sort(findobj(<span class="string">'-regexp'</span>,<span class="string">'Tag'</span>,<span class="string">'FIOS*\w+'</span>));
 <span class="keyword">for</span> ff=ix
     printfiles_report(ff',Cal.dir_figs,<span class="string">'Width'</span>,17,<span class="string">'Height'</span>,9);
 <span class="keyword">end</span>

close <span class="string">all</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018a</a><br></p></div><!--
##### SOURCE BEGIN #####
% options_pub.outputDir=fullfile(pwd,'latex','185','html'); options_pub.showCode=true;
% publish(fullfile(pwd,'cal_report_185a2.m'),options_pub);

%% Brewer Setup
clear all;

file_setup='arenos2019_setup';

eval(file_setup);     % configuracion por defecto
Cal.n_inst=find(Cal.brw==185);
Cal.file_latex=fullfile('.','latex',Cal.brw_str{Cal.n_inst});
Cal.dir_figs=fullfile('latex',filesep(),Cal.brw_str{Cal.n_inst},...
                              filesep(),[Cal.brw_str{Cal.n_inst},'_figures'],filesep());
mkdir(Cal.dir_figs);

try
      save(Cal.file_save,'-Append','Cal'); %sobreescribimos la configuracion guardada.
      load(Cal.file_save);
catch exception
      fprintf('Error: %s\n Initializing data for Brewer %s\n',exception.message,Cal.brw_name{Cal.n_inst});
      save(Cal.file_save);
end

load(Cal.file_save,'temperature');
load(Cal.file_save,'filter');

%% configuration files
close all;

[config_def,TCdef,DTdef,ETCdef,A1def,ATdef]=read_icf(Cal.brw_config_files{Cal.n_inst,2});
[config_orig,TCorig,DTorig,ETCorig,A1orig,ATorig]=read_icf(Cal.brw_config_files{Cal.n_inst,1});

config_temp.n_inst=Cal.n_inst;
config_temp.brw_name=Cal.brw_name{Cal.n_inst};
config_temp.final_days=Cal.Date.FINAL_DAYS(1);

NTC={}; tabla_regress={}; ajuste={}; Args={};

%% Temperature dependence.  During campaign
[sl_rw,tc]=readb_sl_rawl(fullfile('.','bfiles',['B*.',Cal.brw_str{Cal.n_inst}]));% cambio nombres para poder seguir

if ~isnan(sl_rw)
    
    [NTC{1},ajuste{1},Args{1},Fr]=temp_coeff_raw(config_temp,sl_rw,'outlier_flag',0,...
        'date_range',datenum(Cal.Date.cal_year,1,Cal.calibration_days{Cal.n_inst,1}([1 end])));
    
    disp(sprintf(' ORIG MS9: %5.0f +/-%2.0f  %3.1f +/- %3.2f  ',ajuste{1}.orig(7,[1 3 2 4])));
    disp(sprintf('  NEW MS9: %5.0f +/-%2.0f  %3.1f +/- %3.2f  ',ajuste{1}.new(7,[1 3 2 4])));
    
    %%
    makeHtmlTable([ajuste{1}.cero(:,[1 3]) ajuste{1}.cero(:,[2 4])],[],...
        {'slit#2','slit#3','slit#4','slit#5','slit#6','R5','R6'},{'a','a SE','b','b SE'},[],4);
    
    %%
    makeHtmlTable(NTC{1});
else
    Fr=NaN*ones(1,9);
    ajuste{1}.orig=NaN*ones(7,4);
    ajuste{1}.cero=NaN*ones(7,4);
    ajuste{1}.new=NaN*ones(7,4);
    
end

%% Check previous results
if exist('sl_raw','var')
    if iscell(sl_raw) && size(sl_raw,2)>=Cal.n_inst
        if isempty(sl_raw{Cal.n_inst})
           [sl_raw{Cal.n_inst},TC{Cal.n_inst}]=readb_sl_rawl(fullfile(['bdata',Cal.brw_str{Cal.n_inst}],...
                                                             ['B*.',Cal.brw_str{Cal.n_inst}]),'f_plot',1);
           save(Cal.file_save,'-APPEND','sl_raw','TC');
        end
    else
        [sl_raw{Cal.n_inst},TC{Cal.n_inst}]=readb_sl_rawl(fullfile(['bdata',Cal.brw_str{Cal.n_inst}],...
                                                          ['B*.',Cal.brw_str{Cal.n_inst}]),'f_plot',1);
        save(Cal.file_save,'-APPEND','sl_raw','TC');
    end
else
    [sl_raw{Cal.n_inst},TC{Cal.n_inst}]=readb_sl_rawl(fullfile(['bdata',Cal.brw_str{Cal.n_inst}],...
                                                      ['B*.',Cal.brw_str{Cal.n_inst}]),'f_plot',1);
    save(Cal.file_save,'-APPEND','sl_raw','TC');
end

%% SL summary from bfiles temperature
% figure; set(gcf,'Tag','DailySL');
% hl1=ploterr(TC{Cal.n_inst}(1,:),TC{Cal.n_inst}(2,:),[],TC{Cal.n_inst}(3,:),'*k');
% set(hl1,'LineWidth',2);
% ylabel('SL double ratio MS9');
% title(sprintf('Daily means for sl ozone ratio & temperature. Brewer %s\r\n (from bfile sl summaries)',Cal.brw_name{Cal.n_inst}));
% set(gca,'XTickLabels',datestr(get(gca,'XTick'),2));  grid;
% ax(1)=gca; set(ax(1),'Position',[0.1  0.12  0.75  0.72]);% [left bottom width height]
% xtickangle(gca,30);
% ax(2)=axes('Position',get(ax(1),'Position'),...
%    'XAxisLocation','top',...
%    'YAxisLocation','right',...
%    'Color','none','FontSize',10,...
%    'XColor','k','YColor','b'); set(ax,'box','off');
% hold on; hl2=ploterr(TC{Cal.n_inst}(1,:),TC{Cal.n_inst}(7,:),[],TC{Cal.n_inst}(8,:),'*b');
% set(hl2,'LineWidth',2);  set(gca,'XTicklabels',[],'YLim',[0 45]);
% ylb=ylabel('Temperature','Rotation',-90); pos=get(ylb,'Position'); pos(1)=pos(1)+3;
% set(ylb,'Position',pos);

[NTC{2},ajuste{2},Args{2},Fraw,Fnew]=temp_coeff_raw(config_temp,sl_raw{Cal.n_inst},'outlier_flag',1,...
                       'date_range',datenum(Cal.Date.cal_year-2,7,15));   % two years before calibration
                        %'date_range',datenum(Cal.Date.cal_year,1,[1,Cal.calibration_days{Cal.n_inst,1}(1)]));
                        %this year data
                        
                       

% figure(maxf(findobj('Tag','TEMP_OLD_VS_NEW'))); set(gca,'YLim',[1750 1920]);

disp(sprintf(' ORIG MS9: %5.0f +/-%2.0f  %3.1f +/- %3.2f  ',ajuste{2}.orig(7,[1 3 2 4])));
disp(sprintf('  NEW MS9: %5.0f +/-%2.0f  %3.1f +/- %3.2f  ',ajuste{2}.new(7,[1 3 2 4])));

 %%
tc_reg_table=makeHtml_Table([ajuste{2}.cero(:,[1 3]) ajuste{2}.cero(:,[2 4])],[],...
        {'slit#2','slit#3','slit#4','slit#5','slit#6','R5','R6'},{'a','a SE','b','b SE'},[],4)
temperature{Cal.n_inst}.regression_table=tc_reg_table;
%%
tc_coeff_table=makeHtml_Table(NTC{2})
temperature{Cal.n_inst}.coeff_table=tc_coeff_table;

%%  Check changes
[NTCx,ajustex,Argsx,Fraw,Forig]=temp_coeff_raw(config_temp,sl_raw{Cal.n_inst},'outlier_flag',1,'plots',0,...
                                'N_TC',TCorig(1:5)','date_range',datenum(Cal.Date.cal_year-2,1,[Cal.calibration_days{Cal.n_inst,1}(1)]));

Forigx=Forig; Fn=Fnew;

figure;  set(gcf,'Tag','TEMP_COMP_DATE');
plot(Forigx(:,1),Forigx(:,2),'b.','MarkerSize',6); 
ylabel('Temperature','Color','b'); ax(1)=gca; set(ax(1),'YAxisLocation','right','XTicklabels',{' '}); 
[mn,sn]=grpstats(Forigx(:,[1,end,2]),{year(Forigx(:,1)),fix(Forigx(:,1))},{'mean','sem'});
[mt,st]=grpstats(Fn(:,[1,end]),{year(Fn(:,1)),fix(Fn(:,1))},{'mean','sem'}); 
ax(2) = axes('YAxisLocation','left','Color','none'); 
hold all; errorbar(mn(:,1),mn(:,2),sn(:,2),'Color','k','Marker','s');
errorbar(mt(:,1),mt(:,2),st(:,2),'Color','g','Marker','s');
errorbar(mt(:,1),mt(:,2),st(:,2),'Color','g','Marker','s');
title(['R6 Temperature dependence Brewer#', Cal.brw_str{Cal.n_inst}]); ylabel('Standard Lamp R6 ratio');
datetick('x',6,'KeepTicks','KeepLimits'); grid on; 
lg=legend(ax(2),'Old temperature coeff','New temperature coeff','Location','best'); 
set(lg,'HandleVisibility','Off');  set(findobj(lg,'Type','text'),'FontSize',7,'HandleVisibility','Off');    
linkprop(ax,{'Position','XTick'}); 

figure; set(gcf,'Tag','TEMP_COMP_TEMP')
[mn,sn]=grpstats(Forigx(:,[2,end]),Forigx(:,2),{'mean','sem'});
[mt,st]=grpstats(Fn(:,[2,end]),Fn(:,2),{'mean','sem'});
hold on; errorbar(mn(:,1),mn(:,2),sn(:,2),'Color','k','Marker','s');
errorbar(mt(:,1),mt(:,2),st(:,2),'Color','g','Marker','s'); grid;
lg=legend('Old temperature coeff','New temperature coeff','Location','best');
set(lg,'HandleVisibility','Off'); set(findobj(lg,'Type','text'),'FontSize',7,'HandleVisibility','Off');    
title(['R6 Temperature dependence Brewer#', Cal.brw_str{Cal.n_inst}]);
ylabel('Standard Lamp R6 ratio'); xlabel('Temperature'); set(gca,'Box','On');

%%
% ix=sort(findobj('tag','TEMP_COEF_DESC'));
% printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'Width',15,'Height',7,'LockAxes',0,'no_export');

% ix=sort(findobj('tag','TEMP_day_new'));
% printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'Width',14,'Height',9,'LockAxes',0,'no_export');

ix=sort(findobj('tag','TEMP_OLD_VS_NEW'));
printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'Width',12.5,'Height',6.5);

ix=sort(findobj('tag','TEMP_COMP_DATE'));
printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'Width',12.5,'Height',7,'FontMode','fixed','FontSize',9,'axes',1);

ix=sort(findobj('tag','TEMP_COMP_TEMP'));
printfiles_report(ix',Cal.dir_figs,'aux_pattern',ix,'Width',12.5,'Height',6.5);

close all

%% Latex stuff

% Temperature Range
% Para que funcione asignamos la salida Fr en la llamada a la funciÿn
% temp_coeff_raw donde se calculen los TC's (en este caso en {})
tmp=Fr(:,2);
latexcmd(fullfile(Cal.file_latex,['cal_tempcoeff_',Cal.brw_str{Cal.n_inst}]),...
                                  '\tempmin',min(tmp),'\tempmax',max(tmp));
clear tmp;
temperature{Cal.n_inst}.sl_raw=sl_raw{Cal.n_inst};
temperature{Cal.n_inst}.NTC=NTC;
temperature{Cal.n_inst}.ajuste=ajuste;
if exist('Args','var')
temperature{Cal.n_inst}.info=Args;
else warning('No se estÿn guardando los inputs de la funciÿn!!')
end
save(Cal.file_save,'-APPEND','temperature');

% Tables
tc_table={};
 for t=1:length(NTC)
    tc_table{t}=[round(config_orig(2:6)'*10^4)/10^4                             %'Current'
                       NTC{1}                                                   %'Calculated'
                 round(config_def(2:6)'*10^4)/10^4];                            %'Final'

    if t==1, t=[]; indx=1;  else t=t-1; indx=indx+1;  end
       matrix2latex_ctable(tc_table{indx},...
                     fullfile(Cal.file_latex,['table_TC',num2str(t),'_',Cal.brw_str{Cal.n_inst},'.tex']),...
                    'RowLabels',{'Current','Calculated','Final'},...
                    'ColumnLabels',{'slit#2','slit#3','slit#4','slit#5','slit#6'},...
                    'alignment', 'c','resize',0.8,'format','%7.4f','size','footnotesize');
 end

tabla_regress={};
 for tt=1:length(ajuste)

     param=ajuste{tt};
     if isstruct(param)
         param=param.new;
     end
     absc=mmcellstr(sprintf('%g +/- %g |',round(param([1:5 7],[1,3]))'));
     slpe=mmcellstr(sprintf('%3.1f +/- %3.2f |',param([1:5 7],[2,4])'));
     tabla_regress{tt}=cat(2,absc,slpe);

     if tt==1, tt=[]; indx=1;  else tt=tt-1; indx=indx+1;  end
        matrix2latex_ctable(tabla_regress{indx},...
                fullfile(Cal.file_latex,['table_regress',num2str(tt),'_',Cal.brw_str{Cal.n_inst},'.tex']),...
               'RowLabels',{'slit\#2','slit\#3','slit\#4','slit\#5','slit\#6','MS9'},...
               'ColumnLabels',{'0 abscissa +/- standard error','slope +/- standard error'},...
               'alignment', 'c','resize',0.8,'size','footnotesize');
 end

%% Filter attenuation
[ETC_FILTER_CORRECTION,media_fi,fi,fi_avg]=filter_rep(Cal.brw_str{Cal.n_inst},...
                             'date_range',datenum(Cal.Date.cal_year-4,1,1),...
                             'outlier_flag',1,'plot_flag',0,'config',config_orig(17:22));
                             
filter{Cal.n_inst}.ETC_FILTER_CORRECTION=ETC_FILTER_CORRECTION;
filter{Cal.n_inst}.media_fi=media_fi;
filter{Cal.n_inst}.fi=fi;
filter{Cal.n_inst}.ETC_FILTER_COR=round(ETC_FILTER_CORRECTION(2,:).*(sign(ETC_FILTER_CORRECTION(3,:))==sign(ETC_FILTER_CORRECTION(4,:))));                       
filter{Cal.n_inst}.fi_avg=fi_avg;

    o3f=filters_data(filter,Cal);

save(Cal.file_save,'-APPEND','filter');

NFI=size(fi,1); 
NFIcamp=length(find(ismember(fi_avg(:,1),datenum(Cal.Date.cal_year,1,Cal.calibration_days{Cal.n_inst,1}))==1));
latexcmd(fullfile(Cal.file_latex,['cal_filter_',Cal.brw_str{Cal.n_inst}]),'\NFI',NFI,'\NFIcamp',NFIcamp);

label_2={'filter #1','filter #2','filter #3','filter #4','filter #5'};
ETC_FILTER_CORR2cell={};
for y=1:5
    ETC_FILTER_CORR2cell{1,y}=round(ETC_FILTER_CORRECTION(1,y)*10)/10;
    ETC_FILTER_CORR2cell{2,y}=round(ETC_FILTER_CORRECTION(2,y)*10)/10;
    ETC_FILTER_CORR2cell{3,y}=sprintf('%c%s %s%c','[',num2str(round(ETC_FILTER_CORRECTION(3,y)*10)/10),num2str(round(ETC_FILTER_CORRECTION(4,y)*10)/10),']');
end
disp(ETC_FILTER_CORR2cell);
matrix2latex_ctable(ETC_FILTER_CORR2cell,fullfile(Cal.file_latex,['table_filter_correction_',Cal.brw_str{Cal.n_inst},'.tex']),...
                     'rowLabels',{'ETC Filt. Corr. (median)','ETC Filt. Corr. (mean)','ETC Filt. Corr. (mean 95\% CI) '},...
                     'columnLabels',{'filter\#1','filter\#2','filter\#3','filter\#4','filter\#5'},...
                     'alignment', 'c','resize',0.8);
   
label_1={'slit #0','slit #1','slit #2','slit #3','slit #4','slit #5','mean'};
label_2={'filter #1','filter #2','filter #3','filter #4','filter #5'};
% disp([num2cell(media_fi);num2cell(fix(mean(media_fi)))]);
matrix2latex_ctable([num2cell(media_fi);num2cell(fix(mean(media_fi)))],fullfile(Cal.file_latex,['table_filter_',Cal.brw_str{Cal.n_inst},'.tex']),...
                     'rowLabels',{'slit\#0','slit\#1','slit\#2','slit\#3','slit\#4','slit\#5','mean'},...
                     'columnLabels',{'filter\#1','filter\#2','filter\#3','filter\#4','filter\#5'},...
                     'alignment', 'c','resize',0.72);
                 
%%
fprintf('\nFI''s analyzed: %d\n',NFI);
fi_mean_table=display_table([fix(media_fi);fix(mean(media_fi))],label_2,10,'.5g',label_1)
filter{Cal.n_inst}.mean_table=fi_mean_table;
%
%fprintf('\nFI''s analyzed: %d\n',NFI);
fi_etc_table=display_table(ETC_FILTER_CORRECTION,label_2,10,'.5g',{'ETC Filt. Corr. (median)','ETC Filt. Corr. (mean)','ETC Filt. Corr. (CI) ','ETC Filt. Corr.(CI)'})
filter{Cal.n_inst}.etc_table=fi_etc_table;


save(Cal.file_save,'-APPEND','filter');

%%
 figure(maxf(findobj('tag','FI_wavelength')));
 printfiles_report(gcf,Cal.dir_figs,'Width',13.5);
    
 figure(maxf(findobj('tag','FI_STATS')));
 printfiles_report(gcf,Cal.dir_figs,'Width',13,'Height',16);
       
 ix=sort(findobj('-regexp','Tag','FIOS*\w+'));
 for ff=ix
     printfiles_report(ff',Cal.dir_figs,'Width',17,'Height',9);
 end

close all

##### SOURCE END #####
--></body></html>